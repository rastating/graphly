// Copyright (C) 2013 rastating
//
// Version 0.1.3
//
// This program is free software: you can redistribute it and/or modify
// it under the terms of the GNU General Public License as published by
// the Free Software Foundation, either version 3 of the License, or
// (at your option) any later version.
//
// This program is distributed in the hope that it will be useful,
// but WITHOUT ANY WARRANTY; without even the implied warranty of
// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
// GNU General Public License for more details.
//
// You should have received a copy of the GNU General Public License
// along with this program.  If not, see http://www.gnu.org/licenses/.

(function(e){e.fn.graphly=function(n){var r=e.extend({data:null,paddingTop:1,paddingLeft:1,paddingBottom:1,paddingRight:1,showLabels:true,showLegend:true},n);var i={width:0,height:0,paddingTop:r.paddingTop,paddingLeft:r.paddingLeft,paddingBottom:r.paddingBottom,paddingRight:r.paddingRight,barCount:0,largestValue:0,smallestValue:0,largestLabelWidth:0,colors:t.slice(0),top:0,left:0,bottom:0,right:0};var s={initialize:function(t,n){var s=0;var o=null;var u=null;var a=null;i.width=e(t).width();i.height=e(t).height();i.paddingLeft=r.paddingLeft<15?15:r.paddingLeft;i.paddingTop=r.paddingTop<15?15:r.paddingTop;i.paddingRight=r.paddingRight<15?15:r.paddingRight;i.paddingBottom=r.paddingBottom<15?15:r.paddingBottom;e.each(r.data.groups,function(t,r){e.each(r.values,function(e,t){if(o==null||o<t.value){o=t.value}if(u==null||u>t.value){u=t.value}var r=n.measureText(t.label).width;if(a==null||a<r){a=r}if(t.color!=undefined){i.colors[e]=t.color}s+=1})});i.barCount=s;i.largestValue=o;i.smallestValue=u;i.largestLabelWidth=a},drawVerticalLabel:function(e,t,n){e.save();e.translate(t,n);e.rotate(270*Math.PI/180);e.translate(-t,-n);e.fillText(r.data.yLabel,t,n);e.restore()},drawLegend:function(t){var n=i.width-i.paddingRight+15;var s=i.paddingTop+5;var o=s;var u=new Array;e.each(r.data.groups,function(t,n){e.each(n.values,function(t,n){if(e.inArray(n.label,u)==-1){u[u.length]=n.label}})});t.save();t.font='bold 14px "lucida grande",tahoma,verdana,arial,sans-serif';t.fillText("Legend",n,o);t.font='11px "lucida grande",tahoma,verdana,arial,sans-serif';e.each(u,function(e,r){o+=16;t.beginPath();t.rect(n,o,11,11);t.fillStyle=i.colors[e];t.fill();t.closePath();t.textBaseline="top";t.fillText(r,n+13,o-1)});t.restore()},drawValueLabels:function(t){var n=i.smallestValue*-1+i.largestValue;var r=i.bottom-i.top;var s=r/10;var o=null;var u=new Array;t.save();t.font='11px "lucida grande",tahoma,verdana,arial,sans-serif';t.textBaseline="middle";t.textAlign="right";t.strokeStyle="#CCCCCC";t.lineWidth=1;for(var a=0;a<=10;a++){var f=a<10?n-n*(a*10/100)-i.smallestValue*-1:i.smallestValue;var l=t.measureText(Math.round(f));if(o==null||o<l.width){o=l.width}u[a]=Math.round(f)}i.left+=o;e.each(u,function(e,n){t.fillText(n,i.left,i.top+e*s);t.beginPath();t.moveTo(i.left+5,Math.round(i.top+e*s)+.5);t.lineTo(i.right,Math.round(i.top+e*s)+.5);t.stroke();t.closePath()});t.restore()},drawBars:function(t){t.font='11px "lucida grande",tahoma,verdana,arial,sans-serif';i.left+=5;var n=i.left;var s=i.right-i.left;var o=15;var u=(s-o*(r.data.groups.length+1))/i.barCount;var a=i.smallestValue*-1+i.largestValue;var f=(i.bottom-i.top)/a;var l=i.bottom-i.smallestValue*-1*f;e.each(r.data.groups,function(s,a){n+=o;e.each(a.values,function(e,s){var o=s.value*f*-1;t.beginPath();t.rect(n,l,u,o);t.fillStyle=i.colors[e];t.fill();t.closePath();n+=u;if(r.data.groups.length==1){t.textAlign="center";t.fillStyle="#000000";t.fillText(s.label,n-u/2,i.bottom+15)}})});t.restore()},drawAxis:function(e){var t=i.smallestValue*-1+i.largestValue;var n=(i.bottom-i.top)/t;e.beginPath();e.strokeStyle="#000000";e.lindWidth=1;e.moveTo(i.left+.5,i.top);e.lineTo(i.left+.5,i.bottom+.5);e.lineTo(i.right,i.bottom+.5);e.stroke();e.closePath();if(i.smallestValue<0){var r=i.bottom-i.smallestValue*-1*n;e.beginPath();e.strokeStyle="#343434";e.lineWidth=2;e.moveTo(i.left,r+.5);e.lineTo(i.right,r+.5);e.stroke();e.closePath()}}};return this.each(function(){var t=e(this)[0];var n=t.getContext("2d");s.initialize(this,n);if(r.showLegend&&r.data.groups.length>0){i.paddingRight+=i.largestLabelWidth+55;s.drawLegend(n)}i.top=i.paddingTop;i.bottom=i.height-i.paddingBottom;i.left=i.paddingLeft;i.right=i.width-i.paddingRight;var o=i.bottom-i.top;if(r.showLabels){i.bottom-=35;n.font='bold 14px "lucida grande",tahoma,verdana,arial,sans-serif';n.textAlign="center";n.fillText(r.data.xLabel,(i.right+i.left)/2,i.bottom+45);s.drawVerticalLabel(n,i.paddingLeft,i.top+o/2);i.left+=14}i.smallestValue=i.smallestValue>0?0:i.smallestValue;s.drawValueLabels(n);s.drawBars(n);s.drawAxis(n)})};var t=new Array;t[0]="#7CB9E8";t[1]="#FF0038";t[2]="#FFBF00";t[3]="#A4C639";t[4]="#00308F";t[5]="#BF00FF";t[6]="#A32638";t[7]="#FFDB58";t[8]="#E32636";t[9]="#C46210";t[10]="#EFDECD";t[11]="#E52B50";t[12]="#3B7A57";t[13]="#C9FFE5";t[14]="#FF7E00";t[15]="#FF033E";t[16]="#9966CC";t[17]="#B284BE";t[18]="#317873";t[19]="#CD9575";t[20]="#665D1E";t[21]="#915C83";t[22]="#841B2D";t[23]="#C54B8C";t[24]="#008000";t[25]="#8DB600";t[26]="#FBCEB1";t[27]="#00FFFF";t[28]="#7FFFD4";t[29]="#4B5320";t[30]="#3B444B";t[31]="#E9D66B";t[32]="#B2BEB5";t[33]="#87A96B";t[34]="#FF9966";t[35]="#A52A2A";t[36]="#FDEE00";t[37]="#6E7F80";t[38]="#568203";t[39]="#007FFF";t[40]="#F0FFFF";t[41]="#89CFF0";t[42]="#A1CAF1";t[43]="#F4C2C2";t[44]="#FEFEFA";t[45]="#FF91AF";t[46]="#21ABCD";t[47]="#FAE7B5";t[48]="#FFE135";t[49]="#E0218A";t[50]="#7C0A02";t[51]="#848482";t[52]="#98777B";t[53]="#BCD4E6";t[54]="#9F8170";t[55]="#F5F5DC";t[56]="#2E5894";t[57]="#9C2542";t[58]="#FFE4C4";t[59]="#3D2B1F";t[60]="#967117";t[61]="#CAE00D";t[62]="#BFFF00";t[63]="#FE6F5E";t[64]="#BF4F51";t[65]="#000000";t[66]="#3D0C02";t[67]="#253529";t[68]="#3B3C36";t[69]="#FFEBCD";t[70]="#A57164";t[71]="#318CE7";t[72]="#ACE5EE";t[73]="#FAF0BE";t[74]="#0000FF";t[75]="#1F75FE";t[76]="#0093AF";t[77]="#0087BD";t[78]="#333399";t[79]="#0247FE";t[80]="#A2A2D0";t[81]="#6699CC";t[82]="#0D98BA";t[83]="#126180";t[84]="#8A2BE2";t[85]="#5072A7";t[86]="#4F86F7";t[87]="#1C1CF0";t[88]="#DE5D83";t[89]="#79443B";t[90]="#0095B6";t[91]="#E3DAC9";t[92]="#CC0000";t[93]="#006A4E";t[94]="#873260";t[95]="#0070FF";t[96]="#B5A642";t[97]="#CB4154";t[98]="#1DACD6";t[99]="#66FF00";t[100]="#BF94E4";t[101]="#C32148";t[102]="#1974D2";t[103]="#FF007F";t[104]="#08E8DE";t[105]="#D19FE8";t[106]="#F4BBFF";t[107]="#FF55A3";t[108]="#FB607F";t[109]="#004225";t[110]="#CD7F32";t[111]="#737000";t[112]="#964B00";t[113]="#A52A2A";t[114]="#6B4423";t[115]="#1B4D3E";t[116]="#FFC1CC";t[117]="#E7FEFF";t[118]="#F0DC82";t[119]="#7BB661";t[120]="#480607";t[121]="#800020";t[122]="#DEB887";t[123]="#CC5500";t[124]="#E97451";t[125]="#8A3324";t[126]="#BD33A4";t[127]="#702963";t[128]="#536872";t[129]="#5F9EA0";t[130]="#91A3B0";t[131]="#006B3C";t[132]="#ED872D";t[133]="#E30022";t[134]="#FFF600";t[135]="#A67B5B";t[136]="#4B3621";t[137]="#1E4D2B";t[138]="#A3C1AD";t[139]="#C19A6B";t[140]="#EFBBCC";t[141]="#78866B";t[142]="#FFEF00";t[143]="#FF0800";t[144]="#E4717A";t[145]="#00BFFF";t[146]="#592720";t[147]="#C41E3A";t[148]="#00CC99";t[149]="#960018";t[150]="#D70040";t[151]="#EB4C42";t[152]="#5D8AA8";t[153]="#FFA6C9";t[154]="#B31B1B";t[155]="#99BADD";t[156]="#ED9121";t[157]="#00563F";t[158]="#062A78";t[159]="#703642";t[160]="#C95A49";t[161]="#92A1CF";t[162]="#ACE1AF";t[163]="#007BA7";t[164]="#2F847C";t[165]="#B2FFFF";t[166]="#4997D0";t[167]="#DE3163";t[168]="#EC3B83";t[169]="#007BA7";t[170]="#2A52BE";t[171]="#6D9BC3";t[172]="#007AA5";t[173]="#E03C31";t[174]="#A0785A";t[175]="#F7E7CE";t[176]="#36454F";t[177]="#232B2B";t[178]="#E68FAC";t[179]="#DFFF00";t[180]="#7FFF00";t[181]="#DE3163";t[182]="#FFB7C5";t[183]="#954535";t[184]="#DE6FA1";t[185]="#A8516E";t[186]="#AA381E";t[187]="#856088";t[188]="#7B3F00";t[189]="#D2691E";t[190]="#FFA700";t[191]="#98817B";t[192]="#E34234";t[193]="#D2691E";t[194]="#E4D00A";t[195]="#9FA91F";t[196]="#7F1734";t[197]="#FBCCE7";t[198]="#0047AB";t[199]="#D2691E";t[200]="#965A3E";t[201]="#6F4E37";t[202]="#9BDDFF";t[203]="#F88379";t[204]="#002E63";t[205]="#8C92AC";t[206]="#B87333";t[207]="#DA8A67";t[208]="#AD6F69";t[209]="#CB6D51";t[210]="#996666";t[211]="#FF3800";t[212]="#FF7F50";t[213]="#F88379";t[214]="#FF4040";t[215]="#893F45";t[216]="#FBEC5D";t[217]="#B31B1B";t[218]="#6495ED";t[219]="#FFF8DC";t[220]="#FFF8E7";t[221]="#FFBCD9";t[222]="#FFFDD0";t[223]="#DC143C";t[224]="#BE0032";t[225]="#00FFFF";t[226]="#00B7EB";t[227]="#58427C";t[228]="#FFD300";t[229]="#FFFF31";t[230]="#F0E130";t[231]="#00008B";t[232]="#666699";t[233]="#654321";t[234]="#5D3954";t[235]="#A40000";t[236]="#08457E";t[237]="#986960";t[238]="#CD5B45";t[239]="#008B8B";t[240]="#536878";t[241]="#B8860B";t[242]="#A9A9A9";t[243]="#013220";t[244]="#00416A";t[245]="#1A2421";t[246]="#BDB76B";t[247]="#483C32";t[248]="#734F96";t[249]="#534B4F";t[250]="#543D37";t[251]="#8B008B";t[252]="#003366";t[253]="#4A5D23";t[254]="#556B2F";t[255]="#FF8C00";t[256]="#9932CC";t[257]="#779ECB";t[258]="#03C03C";t[259]="#966FD6";t[260]="#C23B22";t[261]="#E75480";t[262]="#003399";t[263]="#872657";t[264]="#8B0000";t[265]="#E9967A";t[266]="#560319";t[267]="#8FBC8F";t[268]="#3C1414";t[269]="#8CBED6";t[270]="#483D8B";t[271]="#2F4F4F";t[272]="#177245";t[273]="#918151";t[274]="#FFA812";t[275]="#483C32";t[276]="#CC4E5C";t[277]="#00CED1";t[278]="#D1BEA8";t[279]="#9400D3";t[280]="#9B870C";t[281]="#00703C";t[282]="#555555";t[283]="#D70A53";t[284]="#A9203E";t[285]="#EF3038";t[286]="#E9692C";t[287]="#DA3287";t[288]="#FAD6A5";t[289]="#B94E48";t[290]="#704241";t[291]="#C154C1";t[292]="#004B49";t[293]="#F5C71A";t[294]="#9955BB";t[295]="#CC00CC";t[296]="#D473D4";t[297]="#355E3B";t[298]="#FFCBA4";t[299]="#FF1493";t[300]="#843F5B";t[301]="#FF9933";t[302]="#00BFFF";t[303]="#4A646C";t[304]="#7E5E60";t[305]="#66424D";t[306]="#BA8759";t[307]="#1560BD";t[308]="#C19A6B";t[309]="#EDC9AF";t[310]="#B9F2FF";t[311]="#696969";t[312]="#9B7653";t[313]="#1E90FF";t[314]="#D71868";t[315]="#85BB65";t[316]="#664C28";t[317]="#967117";t[318]="#00009C";t[319]="#E5CCC9";t[320]="#E1A95F";t[321]="#555D50";t[322]="#C2B280";t[323]="#614051";t[324]="#F0EAD6";t[325]="#1034A6";t[326]="#7DF9FF";t[327]="#FF003F";t[328]="#00FFFF";t[329]="#00FF00";t[330]="#6F00FF";t[331]="#F4BBFF";t[332]="#CCFF00";t[333]="#72A0C1";t[334]="#3F00FF";t[335]="#8F00FF";t[336]="#FFFF33";t[337]="#50C878";t[338]="#1B4D3E";t[339]="#B48395";t[340]="#AB4B52";t[341]="#563C5C";t[342]="#96C8A2";t[343]="#44D7A8";t[344]="#C19A6B";t[345]="#801818";t[346]="#B53389";t[347]="#DE5285";t[348]="#F400A1";t[349]="#E5AA70";t[350]="#4D5D53";t[351]="#FDD5B1";t[352]="#4F7942";t[353]="#FF2800";t[354]="#6C541E";t[355]="#B22222";t[356]="#CE2029";t[357]="#E25822";t[358]="#FC8EAC";t[359]="#6B4423";t[360]="#F7E98E";t[361]="#EEDC82";t[362]="#A2006D";t[363]="#306030";t[364]="#FFBF00";t[365]="#FF1493";t[366]="#CCFF00";t[367]="#FF004F";t[368]="#014421";t[369]="#228B22";t[370]="#A67B5B";t[371]="#856D4D";t[372]="#0072BB";t[373]="#86608E";t[374]="#9EFD38";t[375]="#D473D4";t[376]="#C72C48";t[377]="#F64A8A";t[378]="#77B5FE";t[379]="#AC1E44";t[380]="#A6E7FF";t[381]="#FF00FF";t[382]="#C154C1";t[383]="#FF77FF";t[384]="#C74375";t[385]="#E48400";t[386]="#CC6666";t[387]="#DCDCDC";t[388]="#E49B0F";t[389]="#007F66";t[390]="#18453B";t[391]="#FE5A1D";t[392]="#B06500";t[393]="#6082B6";t[394]="#E6E8FA";t[395]="#00AB66";t[396]="#D4AF37";t[397]="#FFD700";t[398]="#85754E";t[399]="#996515";t[400]="#FCC200";t[401]="#FFDF00";t[402]="#DAA520";t[403]="#A8E4A0";t[404]="#6F2DA8";t[405]="#808080";t[406]="#808080";t[407]="#BEBEBE";t[408]="#465945";t[409]="#8C92AC";t[410]="#00FF00";t[411]="#1CAC78";t[412]="#008000";t[413]="#00A877";t[414]="#009F6B";t[415]="#00A550";t[416]="#66B032";t[417]="#ADFF2F";t[418]="#A99A86";t[419]="#00FF7F";t[420]="#663854";t[421]="#446CCF";t[422]="#5218FA";t[423]="#E9D66B";t[424]="#3FFF00";t[425]="#C90016";t[426]="#DA9100";t[427]="#808000";t[428]="#DF73FF";t[429]="#F400A1";t[430]="#F0FFF0";t[431]="#006DB0";t[432]="#49796B";t[433]="#FF1DCE";t[434]="#FF69B4";t[435]="#355E3B";t[436]="#71A6D2";t[437]="#FCF75E";t[438]="#319177";t[439]="#602F6B";t[440]="#002395";t[441]="#66023C";t[442]="#ED2939";t[443]="#B2EC5D";t[444]="#4C516D";t[445]="#138808";t[446]="#CD5C5C";t[447]="#E3A857";t[448]="#6F00FF";t[449]="#091F92";t[450]="#4B0082";t[451]="#002FA7";t[452]="#FF4F00";t[453]="#BA160C";t[454]="#C0362C";t[455]="#5A4FCF";t[456]="#B3446C";t[457]="#F4F0EC";t[458]="#009000";t[459]="#B2FFFF";t[460]="#FFFFF0";t[461]="#00A86B";t[462]="#264348";t[463]="#5B3256";t[464]="#F8DE7E";t[465]="#D73B3E";t[466]="#A50B5E";t[467]="#DA614E";t[468]="#343434";t[469]="#F4CA16";t[470]="#BDDA57";t[471]="#29AB87";t[472]="#4CBB17";t[473]="#7C1C05";t[474]="#3AB09E";t[475]="#C3B091";t[476]="#F0E68C";t[477]="#882D17";t[478]="#E79FC4";t[479]="#354230";t[480]="#E8000D";t[481]="#087830";t[482]="#D6CADD";t[483]="#26619C";t[484]="#FFFF66";t[485]="#A9BA9D";t[486]="#CF1020";t[487]="#B57EDC";t[488]="#E6E6FA";t[489]="#CCCCFF";t[490]="#FFF0F5";t[491]="#C4C3D0";t[492]="#9457EB";t[493]="#EE82EE";t[494]="#E6E6FA";t[495]="#FBAED2";t[496]="#967BB6";t[497]="#FBA0E3";t[498]="#7CFC00";t[499]="#FFF700";t[500]="#FFFACD";t[501]="#CCA01D";t[502]="#FDFF00";t[503]="#E3FF00";t[504]="#F6EABE";t[505]="#FFF44F";t[506]="#1A1110";t[507]="#545AA7";t[508]="#FDD5B1";t[509]="#ADD8E6";t[510]="#B5651D";t[511]="#E66771";t[512]="#F08080";t[513]="#93CCEA";t[514]="#F56991";t[515]="#E0FFFF";t[516]="#F984EF";t[517]="#FAFAD2";t[518]="#D3D3D3";t[519]="#90EE90";t[520]="#F0E68C";t[521]="#D39BCB";t[522]="#ADDFAD";t[523]="#E6A8D7";t[524]="#B19CD9";t[525]="#FFB6C1";t[526]="#E97451";t[527]="#FFA07A";t[528]="#FF9999";t[529]="#20B2AA";t[530]="#87CEFA";t[531]="#778899";t[532]="#B0C4DE";t[533]="#B38B6D";t[534]="#E68FAC";t[535]="#FFFFE0";t[536]="#C8A2C8";t[537]="#BFFF00";t[538]="#00FF00";t[539]="#32CD32";t[540]="#9DC209";t[541]="#195905";t[542]="#FAF0E6";t[543]="#C19A6B";t[544]="#6CA0DC";t[545]="#674C47";t[546]="#B86D29";t[547]="#6C2E1F";t[548]="#987456";t[549]="#FFE4CD";t[550]="#E62020";t[551]="#FF00FF";t[552]="#FF55A3";t[553]="#CA1F7B";t[554]="#D0417E";t[555]="#FF0090";t[556]="#9F4576";t[557]="#AAF0D1";t[558]="#F8F4FF";t[559]="#C04000";t[560]="#FBEC5D";t[561]="#6050DC";t[562]="#0BDA51";t[563]="#979AAA";t[564]="#FF8243";t[565]="#74C365";t[566]="#880085";t[567]="#C32148";t[568]="#800000";t[569]="#B03060";t[570]="#E0B0FF";t[571]="#915F6D";t[572]="#EF98AA";t[573]="#73C2FB";t[574]="#E5B73B";t[575]="#66DDAA";t[576]="#0000CD";t[577]="#E2062C";t[578]="#AF4035";t[579]="#F3E5AB";t[580]="#035096";t[581]="#1C352D";t[582]="#DDA0DD";t[583]="#BA55D3";t[584]="#0067A5";t[585]="#9370DB";t[586]="#BB3385";t[587]="#AA4069";t[588]="#3CB371";t[589]="#80DAEB";t[590]="#7B68EE";t[591]="#C9DC87";t[592]="#00FA9A";t[593]="#674C47";t[594]="#48D1CC";t[595]="#79443B";t[596]="#D9603B";t[597]="#C71585";t[598]="#F8B878";t[599]="#F8DE7E";t[600]="#FDBCB4";t[601]="#0A7E8C";t[602]="#9C7C38";t[603]="#E4007C";t[604]="#191970";t[605]="#004953";t[606]="#E3F988";t[607]="#FFC40C";t[608]="#3EB489";t[609]="#F5FFFA";t[610]="#98FF98";t[611]="#FFE4E1";t[612]="#FAEBD7";t[613]="#967117";t[614]="#73A9C2";t[615]="#AE0C00";t[616]="#8A9A5B";t[617]="#30BA8F";t[618]="#997A8D"})(jQuery)